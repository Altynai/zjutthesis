% !Mode:: "TeX:UTF-8"

\documentclass[literaturereview]{zjutreport}

\graphicspath{{figures/}}  % 定义所有的eps文件在 figures 子目录下
\begin{document}           % 开始全文

%论文题目：{中文}
\zjuttitle{基于内存数据库的大数据应用系统的设计与实现}
%作者：{中文姓名}{学号}
\zjutauthor{陈佳鹏}{200926630503}
%指导教师：{导师中文名}
\zjutmentor{陈~~~~波}
%个人信息：{毕业年份}{专业名称}
\zjutinfo{2013}{软件工程}
%学院信息：{学院中文}
\zjutcollege{计算机科学与技术学院}
%日期：{提交日期}
\zjutdate{2013年06月}

\input{preface/cover}      % 封面

\frontmatter

\pagenumbering{Roman}
\begingroup % 在组内的chapter不换行
\let\clearpage\relax % chapter之后不换页

%%%%%%%%%% 标题 %%%%%%%%%%
\titleformat{\chapter}[block]{\sihao\heiti\filcenter\bfseries}{\CJKnumber{\thechapter}}{1ex}{}{} % 标题居中，黑体三号
\chapter*{基于内存数据库的大数据应用系统的设计与实现}
\titleformat{\chapter}[block]{\xiaosi\heiti}{\CJKnumber{\thechapter}、}{1ex}{}{} % 恢复标题居左，黑体四号

%%%%%%%%%% 摘要 %%%%%%%%%%
\include{preface/literaturereview_abstract}     % 中文摘要

%%%%%%%%%% 正文 %%%%%%%%%%
\mainmatter
% \makeatletter
\chapter{引言}
在信息化建设中用于对数据进行维护和管理的数据库扮演了一个十分重要的角色，一个合适的数据库系统往往是信息化改造成功与否的关键所在。传统的磁盘数据库（Disk Resident Database，DRDB）由于经过几十年的发展其功能完备，稳定性好，因而经常应用于电信，银行等公司进行客户资料管理，认识部门档案管理等日常应用方面，并且一直以来有着令人满意的表现。然而伴随着科技的发展，涌现出一批新兴行业或传统行业需要新的应用，例如工业控制，数据通信，证券交易，电力调度，航空航天等。这些新的产业所要求的数据库系统通常并不需要数据库具有强大而完备的功能和进行非常复杂的事物处理的能力，却需要数据库能在指定的时刻或时间内对大量的数据进行采集，处理并能正确的响应的高速的性能。
由于“I/O瓶颈”问题，基于磁盘的数
据库系统（Oracle，SQL Server等）不能满足现代应用对数据库的实耐性处理
的要求。内存数据与磁盘数据在访问时间上相差5个数量
级，内存的速度具有嚷显的优势。内存容量增大，而价格
却在不断地下降。从20世纪80年代开始，数据库研究人
员考虑把整个或者大部分数据库放在内存中。内存数据库
（MMDB）是实时数据库研究的基础，井成为了研究的热点。

MMDB与DRDB最主要的区别就是数据主版本的驻留位置不同，前者
驻留在内存，后者驻留在磁盘。由于内存与磁盘在访问速度、
易失性、访问模式等方面存在很大的差异，内存数据库与磁盘
存数据库中数据是常驻内存，处理前不需要从磁盘读取数据， 数据库也存在差别．如表~\ref{tab:table1}~所示。

\begin{table}[htbp]
\caption{MMDB和DRDB的比较}\label{tab:table1}
\vspace{0.5em}{\wuhao
\begin{tabularx}{\textwidth}{lXX}
\toprule[1.5pt]
性能 & MMDB & DRDB\\
\midrule[1pt]
数据存储 & 行、列级储存模型以及段-分区式储存模型，不压球模型在内存中连续存放 & Sybase~IQ采用列级储存，其他数据库系统采用行级存储，在磁盘上连续存放\\
缓冲管理 & 不需要 & 需要\\
并发控制 & 采用封锁机制、多版本等方式，一般采用较大粒度的锁，如库级锁、表级锁或采用乐观封锁机制 & 采用封锁机制、时间戳、多版本等方式，为了提高事务的并发度，一般支持多粒度和多种类型的锁\\
恢复机制 & 备份、日志和检查点技术，采用预提交、组提交等提交方式；用稳定内存来存储日志记录 & 采用备份、日志、检查点、保存点等技术\\
索引结构 & T树索引、hash索引 & B树索引、hash索引\\
查询优化 & 基于CPU代价以及cache代价 & 基于I/O代价\\

\bottomrule[1.5pt]
\end{tabularx}}
\vspace{\baselineskip}
\end{table}

\chapter{研究意义}
内存数据库因为其快速的数据访问能力，使其能比磁盘数据库（DRDB）更适合于需要快速响应
和高事务吞吐量的应用环境。对于那些需要在严格要求的时间段内完成事务请求
的实时应用系统，和需要支持大数据量并发访问的高性能事务处理平台来讲，内
存数据库都是一个理想的选择。此外，在实际生产中，常常出现不能互相访问其内置实时数据库的信息，从而使大量
信息冗余重复存在于各系统中，也就是出现数据孤岛。为了解决这个问题，必须对实时数
据库的数据管理进行合理规划以建立开放的实时数据库系统，使之能够提供高速、及时的
实时数据服务。

\chapter{国内外研究现状}
内存数据库的研究始于20世纪80年代，并逐渐吸引了越来越多的研究者的研兴趣。经过20多年的发展，时至今日研究者们已对它的体系结构，数据组织与存取方法，事务处理，并发控制和恢复备份技术进行了大量的探讨和研究，针对硬件，软件和算法设计提出了许多不同的策略和实现方案，取得了丰硕的成果。目前内存数据库的研究主要集中在一下几个方向：

1. 内存数据库的体系结构，内存数据库的体系结构包括系统的习题结构和存储体系结构两部分内容，系统体系结构方面主要侧重于研究多处理器在MMDB中的应用，而存储体系结构方面则侧重于研究非易失性内存（NV-RAM，UPS RAM等）在MMDB中的应用。

2. 事务处理，事务的处理主要对事务的提交及与之相联的日志记录、查询优化，尤其是联机查询的优化进行了多方面的研究，开发了一些有效的技术。如开发了“提前提交”等策略以优化事务的初始如对事务的初始处理、提交处理、并发控制、完整性和安全性检验等，加速并发事务的响应时间，查询的优化主要在于对减少查询中中间关系的算法的研究。

3. 数据组织与存取方法，这方面主要针对MMDB存储介质的特性设计了许多适合内存特性的数据存储组织结构和存取方式，索引结构和存储策略，MMDB的压缩，如AVL树索引结构，区段式组织结构，位图分配法等。

4. MMDB的备份和恢复，备份方面更是提出了多种方案，为了预防MMDB的崩溃主要是结合检查点和日志来保证MMDB（MMDB）在崩溃后的可恢复性，提出了许多具体的算法如FUZZY（模糊）检验点策略，BLACK/WHITE（黑/白）策略，COPY-ON-UPDATE（变更拷贝）检验点等，同时研究了非易失性内存在MMDB备份中的应用，如“影子内存”技术等。而备份恢复方面则是对MMDB重启之后的装入策略的研究，结合内存数据中数据使用的频率和优先级提出一种最优的装入策略，目前提出了“部分重装”等策略，MMDB的目录恢复后就启动系统，然后根据要求再继续重装，从而提高CPU的使用率和事务的吞吐量。

5. MMDB的并发控制，在短小事务时，往往采用大力度的锁，MMDB近似于串行处理，串行化执行事务一方面使得并发控制的代价几乎完全消除，同时也能减少CPU的cache缓存和虚拟内存页表TLB的刷新频率；而对于长事务和多处理机环境串行处理明显不合适，这样就必需应用而合适的锁机制来支持并发操作，目前提出了二级层次封锁协议方案、乐观并发控制方法、使用可扩展的哈希技术的方法等。

近些年来随着大容量廉价的内存投入市场，使得上诉的各种技术也逐渐在内存数据库的设计和实现上得到了应用，内存数据库也不在停留在理论研究阶段，内存数据库走向了实际应用阶段，各高校和研究机构发布了研究模型系统，一些公司也推出了用于工业的商用内存数据库系统。目前工业应用上比较流行的商用系统有Oracle公司的内存数据库Berkeley DB，内存数据库SQLite，开源的内存数据库FastDB，以及McObject公司的eXtremDB。他们的特点如表~\ref{tab:table2}~所示： 

\begin{table}[htbp]
\caption{主流内存数据库}\label{tab:table2}
\vspace{0.5em}{\wuhao
\begin{tabularx}{\textwidth}{llX}
\toprule[1.5pt]
内存数据库名 & 厂商 & 特点\\
\midrule[1pt]
Berkeley DB & Oracle & Berkeley DB数据库系统简单、小巧、可靠、高性能，提供了一系列应用程序接口（API），应用程序和Berkeley DB所提供的库在一起编译成为可执行程序。每一个记录由关键字和数据（KEY/VALUE）组成的键值对构成\\
SQLite & 开源 & SQLite是一款轻型的数据库，它的设计目标是针对嵌入式系统，提供了很多语言的接口，支持SQL语句，支持事务处理，它占用资源非常的低，支持跨平台操作，操作使用简单。每完成一次操作需要进行内存和磁盘之间的同步\\
ExtremeDB & McObject & ExtremDB是为实时系统及嵌入式系统而特别设计的，完全工作在主内存中，不基于文件系统，支持事务，支持部分SQL，支持稳定的RAM。通过数据库定义语言为应用系统各自的API。具有工业应用强度\\
FastDB & 开源 & FastDB是一个高效率的内存数据库系统，支持事务、在线备份和系统崩溃之后的自动恢复，支持类似SQL语言并提供了C++接口，算法和结构的优化都是基于数据存放在内存中这个假设上，但物理内存较小时也可使用\\
\bottomrule[1.5pt]
\end{tabularx}}
\vspace{\baselineskip}
\end{table}

\chapter{系统实现技术方法研究}
\section{内存数据的组织结构}
在MMDB系统设计时，广泛使用了现代操作
系统提供的共享内存机制，系统初始化时将整个数
据库装入一片共享内存区，运行时，应用进程可以把
整个数据库或一部分映射到自己的虚地址空间进行
直接访问。针对关系和索引数据全在内存中这一特
点，指针在数据结构和数据访问中被广泛的使用。
应用进程可以通过指针，也可以通过位置独立的数
据库偏移量访问数据，无需像DRDB那样与缓冲区
管理器交互。另外，由于指针长度固定，因此变长字
段问题可以很好解决。其次，若一个大的数据对象
在数据库中多次出现，则内存中只需存储一次，其它
地方使用指针来引用。

\subsection{关系的组织结构}
MMDB中关系的存储通常采用分级结构，同时
强调元数据与数据应分区组织，以提高安全性。在
Starburst中，存储结构分两层：段（Segment）和分区
（Partition）。段是可变长的，一个段由多个固定长
的分区组成，每个段存放一个关系，但并不要求构成
一个段的分区空间上连续。分区则是Starburst的
基本内存分配回收单元，其长度固定。分区的结构
由两部分组成，其中Free space存放记录插槽
（Record dot），Heap space存放分区控制信息和记
录（即元组）本身。
整个数据库维护一个段表，段表中的每一项是
一个段控制块。段控制块中包含一个分区表、段
latch、和索引链表的头指针。图2描述了Starburst
的内存数据组织结构图。

从图2中可以看到：一条记录本身放在分区的
Heap区，对记录的访问是通过放在Free区的记录
插槽进行的。记录插槽中包含一个指向相应记录各
字段在Heap中地址的指针数组，由于指针的长度
都一样，因此记录中不等长字段问题可以通过包含
字段指针数组的等长记录插槽解决；同时，在关系创
建后，若增加关系的字段，则可以通过在记录插槽预
留的Tail结构进行扩展，所需空间在分区的Heap
中分配。当一个事务要访问记录时，先根据关键字
查索引，找到该记录的RID。一个RID是一个由段
号、分区号、和记录插槽在分区中的偏移量组成的三元组，用RID可以很快找到记录插槽，从而最终定
位一条记录。

\subsection{索引技术}
\subsubsection{T树}
DRDB采用的索引结构主要是B/B$+$树，其设
计目标是减少访问磁盘数据的IO次数。而在
MMDB中，通常采用了一种新的索引结构T树，其设计
目标是减少内存开销和CPU指令数。T树是由
AVL树和B树发展而来，它是一种一个节点包含多
个元素的二叉树。

%%% TODO 插入T树node图%%%

由于是二叉树，T树保持了AVL树二分查找的
高效率，同时一个T节点包含多个元素，像B树一
样，每个节点的充满程度保持在半满和全满之间，这
样索引一般不再需要溢出块，由插入和删除所引起
的数据移动通常只需在一个节点内进行，减少了为
保持树的平衡所必须进行的旋转操作，因此T树又
保持了B树优异的更新和存储特性。由于索引和
数据全在内存中，在一个T树节点中不需要像B树
那样存放N个索引键值一指针对，只需存放指向内
存中相应记录对应字段的指针，这样索引中变长字
段的存储不再是问题，另外，由于指针一般比它指向
的字段要小，大量的空间也被节省了。

\subsubsection{Hashing}
为了快速地定位数据库的记录，内存数据库中广泛使用
的哈希索引有链接桶哈希（chained bucket hashing）、可扩展哈
希（extendible hashing）、线性哈希（linear hashing）、修正的线
性哈希（modified linear hashing），其中链接桶的哈希使用静
态结构处理冲突，速度很快，但不适合动态环境。基于等值
的比较，哈希技术能够快速地访问数据库，且易于实现，但
不支持范围检索。

\subsection{并发控制}
内存数据库中使用的并发控制与磁盘数据库中的并发控
制基本相同，细节上存在一定差异。由于数据存储在内存中，
事务执行时间较短，持锁时间也较短，系统中冲突较少，所以
可以采用以下方法减少锁的开销：

1）采用较大的锁粒度（如表级锁），因为数据常驻内存后，对数据的竞争已很低，细粒度锁的
优点对改善性能的意义已不大

2）采用乐观加锁方式

3）减少锁的类型

4）将锁信息存储在数据本身。

\subsection{恢复机制}
由于内存的脆弱性和易失性，数据更容易被破坏和丢失，
所以需在磁盘等非易失性存储介质中进行备份，在对数据进
行处理时，需要将日志写到非易失性存储介质中。在MMDB中，只有在事务提交写日志、执行
Checkpoint、以及系统故障恢复时才需要访问磁盘，
基于以上分析，重新设计MMDB的事务提交策略
和Checkpoint方式，对改善系统性能至关重要。

\subsubsection{事务提交处理}
为保证事务的ACID特性，事务提交时必须强
制写日志到磁盘，因此写日志成为系统的瓶颈。如
何提高MMDB中事务提交的速度，常用以下方法：

1）使用稳定内存

2）组提交

3）只记录ReDo日志

\subsubsection{Checkpoints}
在MMDB中，Checkpoint负责将内存数据库映
像存储到磁盘，并截短日志。每次Checkpoint执行
时，检查自上一次checkpoint以后，内存数据库发生
更新的内存页，并将更新保存到checkpoint文件中，
然后删除不再需要的日志文件内容。在系统恢复
时，联合使用Checkpoint文件和日志文件可以加快
恢复速度。为减少对正常事务的干扰。在MMDB
中广泛采用了fuzzy checkpoint技术。

% \makeatother
\backmatter
\endgroup % 组结束
%%%%%%%%%% 参考文献 %%%%%%%%%%
\clearpage % 显式换页，使书签定位准确
\bibliography{references/literaturereview_reference}
\nocite{*}                                   % 若将此命令屏蔽掉，则未引用的文献不会出现在文后的参考文献中。

%%%%%%%%%% 附录 %%%%%%%%%%
%\appendix
%\include{appendix/appendix}            % 附录

\end{document}                                  % 结束全文
