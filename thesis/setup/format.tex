% !Mode:: "TeX:UTF-8"
% Author: Unlucky
% Blog: http://unlucky.orgfree.com/blog

%%%%%%%%%% Fonts Definition and Basics %%%%%%%%%%%%%%%%%
\XeTeXlinebreaklocale "zh"
\XeTeXlinebreakskip = 0pt plus 1pt minus 0.1pt
\setCJKfamilyfont{song}{SimSun}             % 宋体
\newcommand{\song}{\CJKfamily{song}}
\setCJKfamilyfont{fs}{FangSong}             % 仿宋体
\newcommand{\fs}{\CJKfamily{fs}}
\setCJKfamilyfont{kai}{KaiTi}               % 楷体
\newcommand{\kai}{\CJKfamily{kai}}
\setCJKfamilyfont{hei}{SimHei}              % 黑体
\newcommand{\hei}{\CJKfamily{hei}}
\setCJKfamilyfont{li}{LiSu}                 % 隶书
\newcommand{\li}{\CJKfamily{li}}
\setCJKfamilyfont{tnroman}{Times New Roman} % Times New Roman
\newcommand{\tnroman}{\CJKfamily{tnroman}}

\newcommand{\yihao}{\fontsize{26pt}{26pt}\selectfont}       % 一号, 单倍行距
\newcommand{\xiaoyi}{\fontsize{24pt}{24pt}\selectfont}      % 小一, 单倍行距
\newcommand{\erhao}{\fontsize{22pt}{27.5pt}\selectfont}       % 二号, 1.25倍行距
\newcommand{\xiaoer}{\fontsize{18pt}{18pt}\selectfont}      % 小二, 单倍行距
\newcommand{\sanhao}{\fontsize{16pt}{16pt}\selectfont}      % 三号, 单倍行距
\newcommand{\xiaosan}{\fontsize{15pt}{22.5pt}\selectfont}     % 小三, 单倍行距
\newcommand{\sihao}{\fontsize{14pt}{14pt}\selectfont}       % 四号, 单倍行距
\newcommand{\xiaosi}{\fontsize{12pt}{18pt}\selectfont}      % 小四, 单倍行距
\newcommand{\wuhao}{\fontsize{10.5pt}{10.5pt}\selectfont}   % 五号, 单倍行距
\newcommand{\xiaowu}{\fontsize{9pt}{9pt}\selectfont}        % 小五, 单倍行距

\setCJKmainfont{SimSun}
\setCJKmonofont{SimSun}
\setmainfont{Times New Roman}

% \CJKcaption{gb_452}
% \CJKtilde  % 重新定义了波浪符~的意义
\newcommand\prechaptername{第}
\newcommand\postchaptername{章}

% \punctstyle{plain}
% 调整罗列环境的布局
\setitemize{leftmargin=3em,itemsep=0em,partopsep=0em,parsep=0em,topsep=-0em}
\setenumerate{leftmargin=3em,itemsep=0em,partopsep=0em,parsep=0em,topsep=0em}
% \setlength{\baselineskip}{20pt}
% \renewcommand{\baselinestretch}{1.38} % 设置行距

% 避免宏包 hyperref 和 arydshln 不兼容带来的目录链接失效的问题。
\def\temp{\relax}
\let\temp\addcontentsline
\gdef\addcontentsline{\phantomsection\temp}

% 自定义项目列表标签及格式 \begin{publist} 列表项 \end{publist}
\newcounter{pubctr} %自定义新计数器
\newenvironment{publist}{%%%%%定义新环境
  \begin{list}{[\arabic{pubctr}]} %%标签格式
    {
      \usecounter{pubctr}
      \setlength{\leftmargin}{2.5em}   % 左边界 \leftmargin =\itemindent + \labelwidth + \labelsep
      \setlength{\itemindent}{0em}     % 标号缩进量
      \setlength{\labelsep}{1em}       % 标号和列表项之间的距离,默认0.5em
      \setlength{\rightmargin}{0em}    % 右边界
      \setlength{\topsep}{0ex}         % 列表到上下文的垂直距离
      \setlength{\parsep}{0ex}         % 段落间距
      \setlength{\itemsep}{0ex}        % 标签间距
      \setlength{\listparindent}{0pt} % 段落缩进量
    }}
  {\end{list}}%%%%%

\makeatletter
\renewcommand\normalsize{
  \@setfontsize\normalsize{12pt}{12pt} % 小四对应12pt
  \setlength\abovedisplayskip{4pt}
  \setlength\abovedisplayshortskip{4pt}
  \setlength\belowdisplayskip{\abovedisplayskip}
  \setlength\belowdisplayshortskip{\abovedisplayshortskip}
  \let\@listi\@listI}
\def\defaultfont{\renewcommand{\baselinestretch}{1.38}\normalsize\selectfont}
% 设置行距和段落间垂直距离
\renewcommand{\CJKglue}{\hskip 0.96pt plus 0.08\baselineskip} %加大字间距，使每行33个字

\makeatother
%%%%%%%%%%%%% Contents %%%%%%%%%%%%%%%%%
% 主目录设置
\renewcommand{\contentsname}{目\qquad 录}
\setcounter{tocdepth}{1}
\titlecontents{chapter}[2em]{\vspace{.5\baselineskip}\xiaosan\song}%
{\prechaptername\CJKnumber{\thecontentslabel}\postchaptername\qquad}{} %
{\hspace{.5em}\titlerule*[10pt]{$\cdot$}\sihao\contentspage}
\titlecontents{section}[3em]{\vspace{.25\baselineskip}\sihao\song} %
{\thecontentslabel\quad}{} %
{\hspace{.5em}\titlerule*[10pt]{$\cdot$}\sihao\contentspage}
\titlecontents{subsection}[4em]{\vspace{.25\baselineskip}\xiaosi\song} %
{\thecontentslabel\quad}{} %
{\hspace{.5em}\titlerule*[10pt]{$\cdot$}\sihao\contentspage}

% 图目录设置
\renewcommand{\listfigurename}{图目录}
\newcommand{\loflabel}{图}
\renewcommand{\numberline}[1]{\loflabel~#1\hspace*{1em}}

% 表目录设置
\renewcommand{\listtablename}{表目录}
\newcommand{\lotlabel}{表}
\renewcommand{\numberline}[1]{\lotlabel~#1\hspace*{1em}}


%%%%%%%%%% Chapter and Section %%%%%%%%%%%%%%%%%
\setcounter{secnumdepth}{4}
\setlength{\parindent}{2em}
\renewcommand{\chaptername}{\prechaptername\CJKnumber{\thechapter}\postchaptername}
\titleformat{\chapter}{\centering\xiaosan\bfseries}{\chaptername}{2em}{}
\titlespacing{\chapter}{0pt}{0.3\baselineskip}{1\baselineskip}
\titleformat{\section}{\sihao\bfseries}{\thesection}{1em}{}
\titlespacing{\section}{0pt}{0.2\baselineskip}{0.5\baselineskip}
\titleformat{\subsection}{\sihao\bfseries}{\thesubsection}{1em}{}
\titlespacing{\subsection}{0pt}{0.1\baselineskip}{0.3\baselineskip}
\titleformat{\subsubsection}{\sihao\bfseries}{\thesubsubsection}{1em}{}
\titlespacing{\subsubsection}{0pt}{0}{0}

%%%%%%%%%% Table, Figure and Equation %%%%%%%%%%%%%%%%%
\renewcommand{\tablename}{表} % 插表题头
\renewcommand{\figurename}{图} % 插图题头
\renewcommand{\thefigure}{\arabic{chapter}-\arabic{figure}} % 使图编号为 7-1 的格式 %\protect{~}
\renewcommand{\thesubfigure}{\alph{subfigure})}%使子图编号为 a)的格式
\renewcommand{\thesubtable}{(\alph{subtable})} %使子表编号为 a)的格式
\renewcommand{\thetable}{\arabic{chapter}-\arabic{table}}%使表编号为 7-1 的格式
\renewcommand{\theequation}{\arabic{chapter}-\arabic{equation}}%使公式编号为 7-1 的格式

%% 定制浮动图形和表格标题样式
\makeatletter
\long\def\@makecaption#1#2{%
  \vskip\abovecaptionskip
  \sbox\@tempboxa{\centering\wuhao\song{#1\qquad #2} }%
  \ifdim \wd\@tempboxa >\hsize
  \centering\wuhao\song{#1\qquad #2} \par
  \else
  \global \@minipagefalse
  \hb@xt@\hsize{\hfil\box\@tempboxa\hfil}%
  \fi
  \vskip\belowcaptionskip}
\makeatother
\captiondelim{~~~~} %用来控制longtable表头分隔符

%%%%%%%%%% Theorem Environment %%%%%%%%%%%%%%%%%
\theoremstyle{plain}
\theorembodyfont{\song\rmfamily}
\theoremheaderfont{\hei\rmfamily}
\newtheorem{theorem}{定理~}[chapter]
\newtheorem{lemma}{引理~}[chapter]
\newtheorem{axiom}{公理~}[chapter]
\newtheorem{proposition}{命题~}[chapter]
\newtheorem{corollary}{推论~}[chapter]
\newtheorem{definition}{定义~}[chapter]
\newtheorem{conjecture}{猜想~}[chapter]
\newtheorem{example}{例~}[chapter]
\newtheorem{remark}{注~}[chapter]
\newtheorem{algorithm}{算法~}[chapter]
\newenvironment{proof}{\noindent{\hei 证明：}}{\hfill $ \square $ \vskip 4mm}
\theoremsymbol{$\square$}

%%%%%%%%%% Page: number, header and footer  %%%%%%%%%%%%%%%%%

% \frontmatter 或 \pagenumbering{roman}
% \mainmatter 或 \pagenumbering{arabic}
\makeatletter
\renewcommand\frontmatter{\clearpage
  \@mainmatterfalse
  \pagenumbering{Roman}} % 正文前罗马字体编号
\makeatother


%%%%%%%%%% References %%%%%%%%%%%%%%%%%
\renewcommand{\bibname}{参考文献}
% 重定义参考文献样式，来自thu
\makeatletter
\renewenvironment{thebibliography}[1]{%
  \titleformat{\chapter}{\raggedright\sihao\hei}{\chaptername}{2em}{}
  \chapter*{\bibname}%
  \wuhao
  \list{\@biblabel{\@arabic\c@enumiv}}%
  {\renewcommand{\makelabel}[1]{##1\hfill}
    \settowidth\labelwidth{0.5cm}
    \setlength{\labelsep}{0pt}
    \setlength{\itemindent}{0pt}
    \setlength{\leftmargin}{\labelwidth+\labelsep}
    \addtolength{\itemsep}{-0.7em}
    \usecounter{enumiv}%
    \let\p@enumiv\@empty
    \renewcommand\theenumiv{\@arabic\c@enumiv}}%
  \sloppy\frenchspacing
  \clubpenalty4000%
  \@clubpenalty \clubpenalty
  \widowpenalty4000%
  \interlinepenalty4000%
  \sfcode`\.\@m}
{\def\@noitemerr
  {\@latex@warning{Empty `thebibliography' environment}}%
  \endlist\frenchspacing}
\makeatother

\addtolength{\bibsep}{-0.5em} % 缩小参考文献间的垂直间距
\setlength{\bibhang}{2em} %每个条目自第二行起缩进的距离

% 参考文献引用作为上标出现
% \newcommand{\citeup}[1]{\textsuperscript{\cite{#1}}}
\makeatletter
\def\@cite#1#2{\textsuperscript{[{#1\if@tempswa , #2\fi}]}}
\makeatother
%% 引用格式
\bibpunct{[}{]}{,}{s}{}{,}

%%%%%%%%%% Cover %%%%%%%%%%%%%%%%%
% 封面、摘要、版权、致谢格式定义
\makeatletter
\def\ctitle#1{\def\@ctitle{#1}}\def\@ctitle{}
\def\caffil#1{\def\@caffil{#1}}\def\@caffil{}
\def\csubject#1{\def\@csubject{#1}}\def\@csubject{}
\def\cauthor#1{\def\@cauthor{#1}}\def\@cauthor{}
\def\csupervisor#1{\def\@csupervisor{#1}}\def\@csupervisor{}
\def\cdate#1{\def\@cdate{#1}}\def\@cdate{}
\long\def\cabstract#1{\long\def\@cabstract{#1}}\long\def\@cabstract{}
\long\def\eabstract#1{\long\def\@eabstract{#1}}\long\def\@eabstract{}
\def\ckeywords#1{\def\@ckeywords{#1}}\def\@ckeywords{}
\def\ekeywords#1{\def\@ekeywords{#1}}\def\@ekeywords{}
\def\cheading#1{\def\@cheading{#1}}\def\@cheading{}

% 在book文件类别下,\leftmark自动存录各章之章名,\rightmark记录节标题
\pagestyle{fancy}
% 去掉章节标题中的数字 务必放到\pagestyle{fancy}之后才会起作用
%% 不要注销这一行，否则页眉会变成：“第1章1  绪论”样式
\renewcommand{\chaptermark}[1]{\markboth{\chaptername~\ #1}{}}
\fancyhf{}
% \fancyhead[C]{\song\wuhao \leftmark} % 页眉显示章节名称
\fancyhead[C]{\song\xiaowu \@cheading}
% \fancyhead[CO]{\song\wuhao \@cheading}
% \fancyhead[CE]{\song\wuhao \@cheading}
\fancyfoot[C]{\song\xiaowu ~\thepage~}

\fancypagestyle{plain}{% 设置开章页页眉页脚风格
  \fancyhf{}%
  % \fancyhead[C]{\song\wuhao \leftmark}
  \fancyhead[C]{\song\xiaowu \@cheading}
  \fancyfoot[C]{\song\xiaowu ~\thepage~ } %%首页页脚格式
  \renewcommand{\headrulewidth}{0.5pt}%
  \renewcommand{\footrulewidth}{0pt}%
}

% 定义封面
\def\makecover{
  % \cleardoublepage%
  \phantomsection
  \pdfbookmark[-1]{\@ctitle}{ctitle}

  \begin{titlepage}
  	\vspace*{-2.5mm}
    \begin{center}
      %校名
      \begin{figure}[h]
        \centering
        \includegraphics[width=9.84cm]{figures/zjut}
      \end{figure}
      \vspace*{9.66mm}
	  \song\yihao{本科毕业设计说明书（论文）}\\
	  \vspace*{10.0mm}
	  \song\xiaoer\bf{（2013届）}\\
      \vspace*{8.5mm}
      %校徽
      \begin{figure}[h]
        \centering
        \includegraphics[width=2.73cm]{figures/zjutlogo}
      \end{figure}
      \vspace*{0.0mm}
      \renewcommand{\arraystretch}{1.0}
      \begin{tabular}{lc}
        \song\erhao{论文题目\quad} & \song\xiaoer{\@ctitle} \\ \cline{2-2}
      \end{tabular}\\
	  \vspace*{11.1mm}
      \setlength{\arrayrulewidth}{0.5pt}
      {\song\sihao
        \renewcommand{\arraystretch}{2.0}
        \begin{tabular}{lc}
          作者姓名\qquad &  \@cauthor \\ \cline{2-2}
          指导教师\qquad &  \@csupervisor \\ \cline{2-2}
          \\
          学科(专业)\qquad &  \@csubject \\ \cline{2-2}
          所在学院\qquad &  \@caffil \\ \cline{2-2}\cline{2-2}
          提交日期\qquad & \@cdate \\ \cline{2-2}
        \end{tabular}
	  }
    \end{center}
  \end{titlepage}

  %%%%%%%%%%%%%%%%%%% Abstract and Keywords  %%%%%%%%%%%%%%%%%%%%%%%
  \clearpage
  \markboth{摘~要}{摘~要}
  \addcontentsline{toc}{chapter}{摘~要}
  \setlength{\parskip}{24pt}
  \chapter*{\centering\hei\xiaoer{摘\qquad 要}}
  \setlength{\parskip}{18pt}
  \setcounter{page}{1}
  \song\defaultfont
  \setlength{\parskip}{0pt}
  \song\xiaosi{\@cabstract}
  \vspace{15pt}

  \hangafter=1\hangindent=52.3pt\noindent
  \hei\xiaosi\textbf{关键词：} \song\xiaosi{\@ckeywords}

  %%%%%%%%%%%%%%%%%%% English Abstract  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \clearpage
  % \phantomsection
  \markboth{ABSTRACT}{ABSTRACT}
  \addcontentsline{toc}{chapter}{ABSTRACT}
  \setlength{\parskip}{24pt}
  \chapter*{\centering\tnroman\xiaoer\textbf{ABSTRACT}}
  \setlength{\parskip}{18pt}
  % \vspace{\baselineskip}
  \setlength{\parskip}{0pt}
  \@eabstract
  \vspace{15pt}

  \hangafter=1\hangindent=60pt\noindent
  \tnroman\xiaosi\textbf{Keywords:}  \tnroman\xiaosi{\@ekeywords}
}
\makeatother 